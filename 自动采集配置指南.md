# 🤖 自动采集配置指南

## 📋 概述

AI趋势发现平台支持多种自动采集任务，可以定时从各个数据源获取最新的AI项目和趋势信息。

## ⚙️ 配置方式

### 1. 环境变量配置

在 `.env` 文件中添加以下配置：

```bash
# ===== 定时任务总开关 =====
ENABLE_SCHEDULER=true                    # 是否启用定时任务 (true/false)
TIMEZONE=Asia/Shanghai                   # 时区设置

# ===== 全量数据采集 =====
ENABLE_FULL_COLLECTION=true             # 是否启用全量采集
FULL_COLLECTION_SCHEDULE=0 */6 * * *    # 每6小时执行一次

# ===== YouTube专项采集 =====
ENABLE_YOUTUBE_COLLECTION=true          # 是否启用YouTube采集
YOUTUBE_COLLECTION_SCHEDULE=0 */2 * * * # 每2小时执行一次
YOUTUBE_API_KEY=your_youtube_api_key    # YouTube API密钥

# ===== 热度分数更新 =====
ENABLE_SCORE_UPDATE=true                # 是否启用分数更新
SCORE_UPDATE_SCHEDULE=0 * * * *         # 每小时执行一次

# ===== 数据清理 =====
ENABLE_DATA_CLEANUP=true                # 是否启用数据清理
DATA_CLEANUP_SCHEDULE=0 3 * * *         # 每天凌晨3点执行

# ===== API配置 =====
GITHUB_TOKEN=your_github_token          # GitHub API Token
PRODUCTHUNT_TOKEN=your_producthunt_token # Product Hunt API Token
```

### 2. Cron表达式说明

定时任务使用标准的Cron表达式格式：

```
* * * * *
│ │ │ │ │
│ │ │ │ └─── 星期几 (0-7, 0和7都表示周日)
│ │ │ └───── 月份 (1-12)
│ │ └─────── 日期 (1-31)
│ └───────── 小时 (0-23)
└─────────── 分钟 (0-59)
```

**常用示例：**
- `0 */6 * * *` - 每6小时执行一次
- `0 */2 * * *` - 每2小时执行一次
- `0 * * * *` - 每小时执行一次
- `0 3 * * *` - 每天凌晨3点执行
- `0 9 * * 1` - 每周一上午9点执行
- `0 0 1 * *` - 每月1号午夜执行

## 🔧 任务类型详解

### 1. 全量数据采集 (Full Collection)
**功能**: 从所有配置的数据源采集数据
**包含数据源**:
- YouTube (如果配置了API密钥)
- GitHub (如果配置了Token)
- Product Hunt (如果配置了Token)
- HuggingFace

**默认配置**: 每6小时执行一次
**推荐频率**: 4-8小时一次

### 2. YouTube专项采集 (YouTube Collection)
**功能**: 专门采集YouTube上的AI相关内容
**采集内容**:
- AI教育频道信息
- 技术教程视频
- AI工具演示视频
- 创作者数据分析

**默认配置**: 每2小时执行一次
**推荐频率**: 1-3小时一次

### 3. 热度分数更新 (Score Update)
**功能**: 重新计算所有项目的热度分数
**更新指标**:
- GitHub星标数变化
- YouTube播放量变化
- 社交媒体影响力
- 时间衰减因子

**默认配置**: 每小时执行一次
**推荐频率**: 30分钟-2小时一次

### 4. 数据清理 (Data Cleanup)
**功能**: 清理重复和过期数据
**清理内容**:
- 重复项目记录
- 超过1年未更新的低热度项目
- 无效数据记录

**默认配置**: 每天凌晨3点执行
**推荐频率**: 每天一次

## 🚀 启动自动采集

### 方法1: 自动启动（推荐）
启动服务器时自动启用：
```bash
npm run server:dev
```

### 方法2: 环境变量控制
```bash
# 启用所有定时任务
ENABLE_SCHEDULER=true npm run server:dev

# 禁用定时任务
ENABLE_SCHEDULER=false npm run server:dev
```

### 方法3: 通过管理界面
1. 访问 http://localhost:3000/admin
2. 查看"定时任务状态"
3. 手动启动/停止特定任务

## 📊 监控和管理

### 1. 查看任务状态
```bash
# API方式
curl http://localhost:3001/api/admin/scheduler/status

# 管理界面
访问 http://localhost:3000/admin
```

### 2. 手动执行任务
```bash
# 执行全量采集
curl -X POST http://localhost:3001/api/admin/scheduler/execute/fullCollection

# 执行YouTube采集
curl -X POST http://localhost:3001/api/admin/scheduler/execute/youtubeCollection

# 更新热度分数
curl -X POST http://localhost:3001/api/admin/scheduler/execute/scoreUpdate

# 数据清理
curl -X POST http://localhost:3001/api/admin/scheduler/execute/dataCleanup
```

### 3. 启动/停止任务
```bash
# 启动任务
curl -X POST http://localhost:3001/api/admin/scheduler/start/fullCollection

# 停止任务
curl -X POST http://localhost:3001/api/admin/scheduler/stop/fullCollection
```

## 📈 性能优化建议

### 1. 采集频率优化
- **高频数据源** (YouTube): 1-2小时
- **中频数据源** (GitHub): 4-6小时
- **低频数据源** (Product Hunt): 12-24小时

### 2. API配额管理
- **YouTube API**: 每天10,000单位，合理分配使用
- **GitHub API**: 每小时5,000次请求
- **错峰采集**: 避开高峰时段

### 3. 系统资源
- **内存使用**: 大量数据处理时注意内存占用
- **数据库连接**: 合理控制并发连接数
- **网络带宽**: 考虑网络限制

## 🔍 故障排除

### 常见问题

#### 1. 定时任务不执行
**检查项**:
- `ENABLE_SCHEDULER` 是否为 `true`
- Cron表达式格式是否正确
- 服务器是否正常运行

**解决方案**:
```bash
# 检查任务状态
curl http://localhost:3001/api/admin/scheduler/status

# 手动执行测试
curl -X POST http://localhost:3001/api/admin/scheduler/execute/scoreUpdate
```

#### 2. API配额超限
**错误信息**: `quotaExceeded` 或 `Rate limit exceeded`

**解决方案**:
- 减少采集频率
- 配置多个API密钥轮换使用
- 等待配额重置

#### 3. 数据库连接失败
**错误信息**: `MongoDB connection failed`

**解决方案**:
- 检查MongoDB服务状态
- 验证连接字符串
- 检查网络连接

#### 4. 内存不足
**症状**: 服务器响应缓慢或崩溃

**解决方案**:
- 减少并发采集任务
- 增加服务器内存
- 优化数据处理逻辑

### 日志查看
```bash
# 实时查看日志
npm run server:dev

# 查看特定任务日志
grep "YouTube" logs/app.log
grep "定时任务" logs/app.log
```

## 📋 最佳实践

### 1. 生产环境配置
```bash
# 保守的采集频率
FULL_COLLECTION_SCHEDULE=0 */8 * * *    # 每8小时
YOUTUBE_COLLECTION_SCHEDULE=0 */3 * * * # 每3小时
SCORE_UPDATE_SCHEDULE=0 */2 * * *       # 每2小时
DATA_CLEANUP_SCHEDULE=0 2 * * *         # 每天凌晨2点
```

### 2. 开发环境配置
```bash
# 更频繁的采集用于测试
FULL_COLLECTION_SCHEDULE=*/30 * * * *   # 每30分钟
YOUTUBE_COLLECTION_SCHEDULE=*/15 * * * * # 每15分钟
SCORE_UPDATE_SCHEDULE=*/10 * * * *      # 每10分钟
```

### 3. 监控建议
- 设置日志轮转
- 监控API使用量
- 定期检查数据质量
- 备份重要数据

## 🎯 快速配置模板

### 基础配置（推荐新手）
```bash
# 复制到 .env 文件
ENABLE_SCHEDULER=true
TIMEZONE=Asia/Shanghai
ENABLE_FULL_COLLECTION=true
FULL_COLLECTION_SCHEDULE=0 */6 * * *
ENABLE_SCORE_UPDATE=true
SCORE_UPDATE_SCHEDULE=0 * * * *
ENABLE_DATA_CLEANUP=true
DATA_CLEANUP_SCHEDULE=0 3 * * *

# 可选：YouTube采集
ENABLE_YOUTUBE_COLLECTION=false
# YOUTUBE_API_KEY=your_api_key_here
```

### 高级配置（适合有API密钥）
```bash
# 完整功能配置
ENABLE_SCHEDULER=true
TIMEZONE=Asia/Shanghai

# 全量采集
ENABLE_FULL_COLLECTION=true
FULL_COLLECTION_SCHEDULE=0 */4 * * *

# YouTube专项采集
ENABLE_YOUTUBE_COLLECTION=true
YOUTUBE_COLLECTION_SCHEDULE=0 */2 * * *
YOUTUBE_API_KEY=your_youtube_api_key

# 分数更新
ENABLE_SCORE_UPDATE=true
SCORE_UPDATE_SCHEDULE=0 * * * *

# 数据清理
ENABLE_DATA_CLEANUP=true
DATA_CLEANUP_SCHEDULE=0 3 * * *

# API密钥
GITHUB_TOKEN=your_github_token
PRODUCTHUNT_TOKEN=your_producthunt_token
```

---

配置完成后，你的AI趋势发现平台将自动：
- 🔄 定时采集最新AI项目数据
- 📊 更新项目热度评分
- 🧹 清理重复和过期数据
- 📈 保持数据的新鲜度和准确性

开始享受自动化的AI趋势监控吧！ 🚀